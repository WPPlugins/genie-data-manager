function DM_IsSet(e){if(e!=null&&typeof e!="undefined"){return true}return false}function DM_Item(e){var t=Object.getOwnPropertyNames(e);var n=this;for(var r=0;r<t.length;r++){var i=t[r];if(typeof i=="undefined")continue;n[i]=ko.observable(e[t[r]]);n[i+"_computed"]=ko.computed(function(){propName=this;return n[propName]()},i);n[i+"_OldValue"]=ko.observable(e[t[r]])}n["isvisible"]=ko.observable(true);n["isfiltermatch"]=ko.observable(true);n["newRow"]=ko.observable(false);n["isOnPage"]=ko.observable(true);n["ShowExtend"]=ko.observable(false);n["ShowExtend_computed"]=ko.computed(function(){return n["ShowExtend"]()})}function DM_Value(e){var t=this;t["value"]=ko.observable(e["fieldValue"]);t["fieldValue"]=ko.observable(e["fieldValue"]);t["fieldText"]=ko.observable(e["fieldText"]);t["id"]=ko.observable(e["id"]);if(DM_IsSet(e["hasExtra"])&&e["hasExtra"]&&DM_IsSet(e["extraValue"])){t[e["extraValue"]]=ko.observable(e[e["extraValue"]])}t["isfiltermatch"]=ko.observable(true);t["ShowExtend"]=ko.observable(false);t["ShowExtend_computed"]=ko.computed(function(){return t["ShowExtend"]()})}function DM_ItemFromItem(e){var t=Object.getOwnPropertyNames(e);var n=this;for(var r=0;r<t.length;r++){var i=t[r];if(typeof i=="undefined")continue;n[i]=ko.observable(e[t[r]]());n[i+"_OldValue"]=ko.observable(e[t[r]]())}n["isvisible"]=ko.observable(true);n["isfiltermatch"]=ko.observable(true);n["newRow"]=ko.observable(false);n["isOnPage"]=ko.observable(true);n["ShowExtend"]=ko.observable(false);n["ShowExtend_computed"]=ko.computed(function(){return n["ShowExtend"]()})}function DM_SpecialFilter(e){var t=Object.getOwnPropertyNames(e);var n=this;for(var r=0;r<t.length;r++){var i=t[r];if(typeof i=="undefined")continue;n[i]=ko.observable();n[i+"_computed"]=ko.computed(function(){propName=this;return n[this]()},i)}n["ShowExtend"]=ko.observable(false);n["ShowExtend_computed"]=ko.computed(function(){return n["ShowExtend"]()})}function DM_Special(e){var t=Object.getOwnPropertyNames(e);var n=this;for(var r=0;r<t.length;r++){var i=t[r];if(typeof i=="undefined")continue;n[i]=ko.observable(e[i]);n[i+"_computed"]=ko.computed(function(){propName=this;return n[this]()},i)}n["ShowExtend"]=ko.observable(false);n["ShowExtend_computed"]=ko.computed(function(){return n["ShowExtend"]()})}function DM_Copy(e,t){var n=Object.getOwnPropertyNames(e);var r=this;for(var i=0;i<n.length;i++){var s=n[i];if(typeof s=="undefined")continue;try{r[s]=ko.observable(e[s]())}catch(o){}}if(typeof r["ShowExtend"]!="undefined"){r["ShowExtend_computed"]=ko.computed(function(){return r["ShowExtend"]()})}if(typeof t!="undefined"&&t!=null){r["ShowExtend"](t);r["ShowExtend"].notifySubscribers()}}function DM_CopyFromFilter(e,t){var n=Object.getOwnPropertyNames(t);var r=e;for(var i=0;i<n.length;i++){var s=n[i];if(typeof s=="undefined")continue;if(DM_IsSet(t[s])&&t[s]()!=""&&DM_IsSet(r[s])){try{if(s.indexOf("_computed")==-1&&s.indexOf("Model")==-1){var o=t[s]();if(o!=""&&o!=null){if(DM_IsSet(r[s])&&r[s]!=null){r[s](o)}else{r[s]=ko.observable(o)}}}}catch(u){}}}}function DM_Edit(e,t){var n=Object.getOwnPropertyNames(t);for(var r=0;r<n.length;r++){var i=n[r];if(typeof i=="undefined"||typeof e[i]=="undefined")continue;e[i]=ko.observable(t[i])}}function DM_Connected(e){var t=Object.getOwnPropertyNames(e);var n=this;n["modelname"]=ko.observable(e["modelname"]);n["parentField"]=ko.observable(e["parentField"]);n["childField"]=ko.observable(e["childField"]);n["type"]=ko.observable(e["type"])}function DM_AddFormulas(datarow,formulas){if(DM_IsSet(formulas)){var props=Object.getOwnPropertyNames(datarow);for(var i=0;i<props.length;i++){var propertyName=props[i];for(var j=0;j<formulas.length;j++){if(formulas[j]["current"]==propertyName){var formulaD=formulas[j];datarow[propertyName+"_formula"]=formulaD;datarow[propertyName+"_computed"]=ko.computed({read:function(){thisPropertyName=this;formulaDetails=datarow[thisPropertyName+"_formula"];fexpression=formulaDetails["formula"];expressionChanged=false;hasOldValues=false;expressionNulled=false;evaluate=false;for(var t=0;t<formulaDetails["fields"].length;t++){fieldName=formulaDetails["fields"][t];if(DM_IsSet(datarow[fieldName])){fieldValue=datarow[fieldName]();fexpression=fexpression.replace("[@"+fieldName+"@]",fieldValue);if(typeof datarow[fieldName+"_OldValue"]=="undefined"){evaluate=true}if(DM_IsSet(datarow[fieldName+"_OldValue"])){hasOldValues=true;if(datarow[fieldName+"_OldValue"]()!=datarow[fieldName]()&&!(datarow[fieldName]()==""&&datarow[fieldName+"_OldValue"]()=="0")){expressionChanged=true}if(datarow[fieldName]()==""&&datarow[fieldName+"_OldValue"]()=="0"){expressionNulled=true}}}}value=fexpression;if(DM_IsSet(formulaDetails["isMatematic"])&&formulaDetails["isMatematic"]=="1"){try{value=eval(fexpression)}catch(e){}}if(!hasOldValues||expressionChanged||evaluate){datarow[thisPropertyName](value);datarow[thisPropertyName].notifySubscribers();return value}else{if(expressionNulled&&DM_IsSet(datarow[thisPropertyName+"_OldValue"])&&datarow[thisPropertyName]()!=datarow[thisPropertyName+"_OldValue"]()){datarow[thisPropertyName](datarow[thisPropertyName+"_OldValue"]())}return datarow[thisPropertyName]()}},write:function(e){datarow[this](e)}},propertyName)}}}}}function DM_AddValidators(e,t){for(var n=0;n<t.length;n++){var r=t[n]["name"];var i=t[n]["validator"];var s=t[n]["message"];if(typeof e[r]!="undefined"){switch(i){case"required":e[r].extend({required:{params:true,message:s}});break;case"date":e[r].extend({date:{params:true,message:s}});break;case"number":e[r].extend({number:{params:true,message:s}});break;case"email":e[r].extend({email:{params:true,message:s}});break}}}e["errors"]=ko.validation.group(e);e["isValid"]=ko.computed(function(){if(this.errors().length==0){return true}else{return false}},e);e["showErrors"]=function(){e.errors.showAllMessages()}}function DM_Page(e){Item=this;Item["num"]=ko.observable(e);Item["currNum"]=ko.computed(function(){return Item["num"]()})}function DM_Connection(e){var t=Object.getOwnPropertyNames(e);var n=this;for(var r=0;r<t.length;r++){var i=t[r];if(typeof i=="undefined")continue;n[i]=ko.observable()}}function DM_Model(e,t,n){if(typeof n=="undefined"){n=false}var r=this;r.formName=t;r.lastResult=ko.observable();r.errorMessage=ko.observable();r.successMessage=ko.observable();r.AddSpecialMemberModel=function(e,t){for(j=0;j<r.MyModels.length;j++){var n=r.MyModels[j]["name"];var i=r.MyModels[j]["type"];if(i=="fieldValues"){if(DM_IsSet(n)&&r.MyModels[j]["forModelname"]==e&&DM_IsSet(r.MyModels[j]["isConnected"])&&r.MyModels[j]["isConnected"]&&DM_IsSet(r.MyModels[j]["forModelname"])&&DM_IsSet(r.MyModels[j]["ParentFieldName"])){r[n+"_ParentFieldName"]=r.MyModels[j]["ParentFieldName"];r[n+"_forModelname"]=r.MyModels[j]["forModelname"];varsCompute=ko.computed(function(){modelName=this;if(!DM_IsSet(t[modelName])){t[modelName]=ko.observableArray([])}if(DM_IsSet(t[r[modelName+"_ParentFieldName"]]())){t[r[modelName+"_ParentFieldName"]]();myArray=ko.utils.arrayFilter(r[modelName](),function(e){return t[r[modelName+"_ParentFieldName"]]()==e[r[modelName+"_ParentFieldName"]]()});t[modelName](myArray)}},n)}}}};r.CreateSpecialArray=function(e,t,n,i,s,o,u){if(r[e+t]==null||typeof r[e+t]=="undefined"){r[e+t]=ko.observableArray();if(t=="_filterRow"){var a=new DM_SpecialFilter(n[0]);var f=new DM_SpecialFilter(n[0]);if(o!=null){DM_Edit(a,o);DM_Edit(f,o)}}else{var a=new DM_Special(n[0]);var f=new DM_Special(n[0])}if(s){DM_AddValidators(a,i);DM_AddFormulas(a,u);DM_AddValidators(f,i);DM_AddFormulas(f,u)}r.AddSpecialMemberModel(e,a);r[e+t].push(a);r[e+t+"Validators"]=i;r[e+t+"Formulas"]=u;r.AddSpecialMemberModel(e,f);r[e+t+"Reserve"]=f}else{if(r[e+"_isFiltered"]==true){filterow=r[e+"_filterRow"]()[0];r.filterMyDataHelper(e,filterow,"")}else{r[e+t]([]);if(t=="_filterRow"){var a=new DM_SpecialFilter(n[0]);var f=new DM_SpecialFilter(n[0]);if(o!=null){DM_Edit(a,o);DM_Edit(f,o)}}else{var a=new DM_Special(n[0]);var f=new DM_SpecialFilter(n[0])}if(s){DM_AddValidators(a,i);DM_AddFormulas(a,u);DM_AddValidators(f,i);DM_AddFormulas(f,u)}r.AddSpecialMemberModel(e,a);r[e+t].push(a);r.AddSpecialMemberModel(e,f);r[e+t+"Reserve"]=f}}};r.isValid=function(e){if(typeof r[e]!="undefined"){var t=true;ko.utils.arrayForEach(r[e](),function(e){if(typeof e["isValid"]!="undefined"&&e["isValid"]()==false){t=false;e["showErrors"]()}});return t}};r.filterByPage=function(e){count=0;pagenum=r[e+"pagenum"]();pagesize=r[e+"pagesize"];ko.utils.arrayForEach(r[e](),function(e){if(e["isfiltermatch"]()==true){count++;if(count>(pagenum-1)*pagesize&&count<=pagenum*pagesize){e["isOnPage"](true)}else{e["isOnPage"](false)}}else{e["isOnPage"](false)}});if(DM_IsSet(r[e+"trigger"])){r[e+"trigger"].notifySubscribers()}};r.changePage=function(e,t){if(typeof r[e]!="undefined"&&typeof r[e+"pagenum"]!="undefined"){r[e+"pagenum"](t);r.filterByPage(e)}};r.initiateArray=function(e,t){for(j=0;j<r.MyModels.length;j++){var n=r.MyModels[j]["name"];var i=r.MyModels[j]["type"];if(i=="fieldValues"){if(DM_IsSet(n)&&r.MyModels[j]["forModelname"]==e&&DM_IsSet(r.MyModels[j]["isConnected"])&&r.MyModels[j]["isConnected"]&&DM_IsSet(r.MyModels[j]["forModelname"])&&DM_IsSet(r.MyModels[j]["ParentFieldName"])){r[n+"_ParentFieldName"]=r.MyModels[j]["ParentFieldName"];r[n+"_forModelname"]=r.MyModels[j]["forModelname"];ko.utils.arrayForEach(t,function(t){r.AddSpecialMemberModel(e,t)})}}}if(r[e]==null||typeof r[e]=="undefined"){r[e]=ko.observableArray([])}r[e](t)};r.filterMyData=function(e){if(r[e]!=null&&typeof (r[e]!="undefined")&&r[e+"_filterRow"]!=null&&typeof (r[e+"_filterRow"]!="undefined")){if(DM_IsSet(r[e+"_DefaultQuery"])&&r[e+"_DefaultQuery"]==true){filterow=r[e+"_filterRow"]()[0];var t={action:"DMDynamicRequest",formaction:"GetDataById",formParameters:{formName:e,formId:r.formName},filter:{name:e,data:ko.toJS(filterow)}};var n=function(t){var n=t.indexOf('{"error":');var i=t.substring(n,t.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){r[e+"_errorMessage"](s["error"]);$("body").css("cursor","default")}else{if(typeof s["updatedData"]!="undefined"&&s["updatedData"]!=null){r.ReadData(s["updatedData"]);r[e+"_filterRow"]([]);r.AddSpecialMemberModel(e,filterow);r[e+"_filterRow"].push(filterow);r[e+"_isFilteredDefault"]=true;r.filterMyDataHelper(e,filterow,"_newOne");$("body").css("cursor","default")}}};r[e+"_successMessage"]();r[e+"_errorMessage"]();$("body").css("cursor","progress");applyToServer(n,n,t)}else{filterow=r[e+"_filterRow"]()[0];r.filterMyDataHelper(e,filterow,"")}}};r.RestoreFilters=function(){for(i=0;i<r.MyModels;i++){thisModel=r.MyModels[i];modelname=r.MyModels[i]["name"];thistype=r.MyModels[i]["type"];if(DM_IsSet(r[modelname+"_connected"])&&thistype=="group"&&DM_IsSet(r[modelname+"_filterRow"])){ko.utils.arrayForEach(r[modelname+"_connected"](),function(e){if(DM_IsSet(e["modelname"])){submodelName=e["modelname"]();type="_"+e["type"]();if(DM_IsSet(submodelName)&&DM_IsSet(r[submodelName])&&DM_IsSet(r[submodelName+type])){filterow=r[modelname+"_filterRow"]()[0];filterowCopy=r[submodelName+type]()[0];r.copySameParameters(filterow,filterowCopy,e)}}})}}};r.filterMyDataHelper=function(e,t,n){if(DM_IsSet(r[e+"_connected"])){ko.utils.arrayForEach(r[e+"_connected"](),function(e){if(DM_IsSet(e["modelname"])){submodelName=e["modelname"]();type="_"+e["type"]();if(type=="_group"){type="_filterRow"}if(DM_IsSet(submodelName)&&DM_IsSet(r[submodelName])&&DM_IsSet(r[submodelName+type])){filterowCopy=r[submodelName+type]()[0];r.copySameParameters(t,filterowCopy,e);if(type=="_filterRow"&&n==""){r.filterRow(submodelName,filterowCopy)}else{r[submodelName+"_isFilteredDefault"]=true;if(n==type||n==""){r[submodelName+type]([]);r.AddSpecialMemberModel(submodelName,filterowCopy);r[submodelName+type].push(filterowCopy)}}}}})}if(n==""){r.filterRow(e,t)}};r.copySameParameters=function(e,t,n){parentField=n["parentField"]();childField=n["childField"]();if(DM_IsSet(e[parentField])&&typeof t[childField]!="undefined"){t[childField](e[parentField]());t[childField].notifySubscribers()}};r.filterRow=function(e,t){ko.utils.arrayForEach(r[e](),function(e){e["isfiltermatch"](true);var n=Object.getOwnPropertyNames(e);for(var r=0;r<n.length;r++){propname=n[r];if(typeof propname!="undefined"&&typeof t[propname]!="undefined"&&typeof t[propname]()!="undefined"&&t[propname]()!=null&&propname.search("_model")==-1){if(String(e[propname]()).search(String(t[propname]()))==-1){e["isfiltermatch"](false)}}}});r[e+"_isFiltered"]=true;r.changePage(e,1)};r.filterByParameter=function(e,t,n){if(r[e]!=null&&typeof (r[e]!="undefined")){ko.utils.arrayForEach(r[e](),function(e){e["isfiltermatch"](true);propname=t;if(typeof propname!="undefined"&&typeof e[propname]()!="undefined"&&e[propname]()!=null&&propname.search("_model")==-1){if(String(e[propname]()).search(String(n))==-1){e["isfiltermatch"](false)}}});r[e+"pagetrigger"].notifySubscribers();r.changePage(e,1)}};r.ReadData=function(e){if(!DM_IsSet(r.MyModels)){r.MyModels=e}else{for(var t=0;t<e.length;t++){var n=e[t]["name"];var i=e[t]["type"];for(var s=0;s<r.MyModels.length;s++){var o=r.MyModels[s]["name"];var u=r.MyModels[s]["type"];if(n==o&&i==u){r.MyModels[s]=e[t]}}}}for(var t=0;t<e.length;t++){var a=e[t]["data"];var n=e[t]["name"];var i=e[t]["type"];if(i=="fieldValues"){var f=ko.utils.arrayMap(a,function(e){var t=new DM_Value(e);return t});r.initiateArray(n,f)}}for(var t=0;t<e.length;t++){var a=e[t]["data"];var n=e[t]["name"];var i=e[t]["type"];var l=e[t]["pagesize"];var c=e[t]["pagenum"];var h=e[t]["validators"];var p=e[t]["formulas"];var d=e[t]["connected"];var v=e[t]["applyFilters"];var m=e[t]["applyDefaultQuery"];var g=e[t]["empty"];if(DM_IsSet(n)&&!DM_IsSet(r[n+"_errorMessage"])){r[n+"_errorMessage"]=ko.observable();r[n+"_errorMessage_computed"]=ko.computed(function(){r[this+"_errorMessage"]();return r[this+"_errorMessage"]()},n)}if(DM_IsSet(n)&&!DM_IsSet(r[n+"_successMessage"])){r[n+"_successMessage"]=ko.observable();r[n+"_successMessage_computed"]=ko.computed(function(){r[this+"_successMessage"]();return r[this+"_successMessage"]()},n)}switch(i){case"group":if(DM_IsSet(m)){r[n+"_DefaultQuery"]=m}r[n+"trigger"]=ko.observable();r[n+"pagetrigger"]=ko.observable();var f=ko.utils.arrayMap(a,function(e){var t=new DM_Item(e);DM_AddValidators(t,h);DM_AddFormulas(t,p);r.AddSpecialMemberModel(n,t);return t});r.initiateArray(n,f);if(DM_IsSet(d)){var y=ko.utils.arrayMap(d,function(e){var t=new DM_Connected(e);return t});if(y.length>0){r.initiateArray(n+"_connected",y)}}r[n+"pagesize"]=l;if(r[n+"filteredlength"]==null||typeof r[n+"filteredlength"]=="undefined"){r[n+"filteredlength"]=ko.computed(function(){modelName=this;r[modelName+"trigger"]();count=0;ko.utils.arrayForEach(r[modelName](),function(e){if(e["isfiltermatch"]()==true)count++});r[modelName+"pagetrigger"].notifySubscribers();return count},n)}if(r[n+"mypages"]==null||typeof r[n+"mypages"]=="undefined"){r[n+"mypages"]=ko.computed(function(){modelName=this;r[modelName+"pagetrigger"]();l=r[modelName+"pagesize"];var e=Math.floor(r[modelName+"filteredlength"]()/l);if(r[modelName+"filteredlength"]()>e*l){e++}var t=ko.observableArray([]);for(var n=1;n<=e;n++){t.push(new DM_Page(n))}return t},n)}if(!DM_IsSet(r[n+"_empty"])){r[n+"_empty"]=ko.observable(g)}else{r[n+"_empty"](g)}r[n+"_empty_computed"]=ko.computed(function(){if(r[this+"_empty"]())return false;else return true},n);if(!DM_IsSet(r[n+"pagenum"])){r[n+"pagenum"]=ko.observable(c)}else{r[n+"pagenum"](c)}r[n+"pagenumComputed"]=ko.computed(function(){modelName=this;r[modelName+"trigger"].notifySubscribers();return r[modelName+"pagenum"]()},n);r.filterByPage(n);defaultFilters=e[t]["defaultFilters"];if(DM_IsSet(v)&&v==true&&DM_IsSet(defaultFilters)){r[n+"_toFilter"]=true;r.CreateSpecialArray(n,"_filterRow",a,h,false,defaultFilters,p)}else{r.CreateSpecialArray(n,"_filterRow",a,h,false,null,p)}r.CreateSpecialArray(n,"_new",a,h,true,null,p);break;case"search":r.CreateSpecialArray(n,"_search",a,h,false,null,p);break;case"newOne":r.CreateSpecialArray(n,"_newOne",a,h,true,null,p);break}}r.RestoreFilters();for(var t=0;t<e.length;t++){var n=e[t]["name"];var i=e[t]["type"];if(i=="group"&&DM_IsSet(r[n+"_connected"])&&DM_IsSet(r[n+"_DefaultQuery"])&&r[n+"_DefaultQuery"]==true){for(var b=0;b<r[n+"_connected"]().length;b++){var w=r[n+"_connected"]()[0];submodelName=w["modelname"]();if(DM_IsSet(r[n+"_filterRow"])&&r[n+"_filterRow"]().length>0){r[submodelName+"_parentFilter"]=r[n+"_filterRow"]()[0];r[submodelName+"_sendParentFilter"]=true;r[submodelName+"_parentFilterName"]=n}}}if(r[n+"_toFilter"]==true){if(DM_IsSet(r[n+"_DefaultQuery"])&&r[n+"_DefaultQuery"]==true){r.filterMyDataHelper(n,r[n+"_filterRow"]()[0],"_newOne")}else{r.filterMyDataHelper(n,r[n+"_filterRow"]()[0],"")}}}};if(!n){var s=JSON.parse(e)}else{var s=e}r.ReadData(s);r.addToForm=function(e){if(DM_IsSet(e["field_29"])&&e["field_29"]()!=""){MyText="<p><strong>[@label_id_"+e["field_29"]()+"@]</strong><br/>"+"[@field_id_"+e["field_29"]()+"@]<p>";tinyMCE.activeEditor.execCommand("mceInsertContent",false,MyText)}};r.addToFormShortcode=function(e,t,n){if(DM_IsSet(e[t])&&e[t]()!=""){MyText=n.replace("[$ShortCode$]",e[t]());tinyMCE.activeEditor.execCommand("mceInsertContent",false,MyText)}};r.addToTextAreaShortcode=function(e,t,n,r){if(DM_IsSet(e[t])&&e[t]()!=""&&DM_IsSet(e[n])){MyText=r.replace("[$ShortCode$]",e[t]());oldCode=e[n]();NewCode=oldCode+MyText;e[n](NewCode)}};r.replaceTextShortcode=function(e,t,n,r){if(DM_IsSet(e[t])&&e[t]()!=""&&DM_IsSet(e[n])){MyText=r.replace("[$ShortCode$]",e[t]());e[n](MyText)}};r.searchData=function(e){var t={action:"DMDynamicRequest",formaction:"Search",formParameters:{formName:e,formId:r.formName},model:{name:e,data:ko.toJS(r[e+"_search"])}};var n=function(t){var n=t.indexOf('{"error":');var i=t.substring(n,t.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){r[e+"_errorMessage"](s["error"]);$("body").css("cursor","default")}else{if(typeof s["result"]!="undefined"&&s["result"]!=null&&typeof s["updatedData"]!="undefined"&&s["updatedData"]!=null){r[e+"_successMessage"](s["result"]);r.ReadData(s["updatedData"]);$("body").css("cursor","default")}}};r[e+"_successMessage"]();r[e+"_errorMessage"]();$("body").css("cursor","progress");applyToServer(n,n,t)};r.addData=function(e){var t=null;var n=null;var i=null;var s=null;if(DM_IsSet(r[e+"_DefaultQuery"])&&r[e+"_DefaultQuery"]==true||DM_IsSet(r[e+"_sendParentFilter"])&&r[e+"_sendParentFilter"]==true){if(DM_IsSet(r[e+"_sendParentFilter"])&&r[e+"_sendParentFilter"]==true){t=r[e+"_parentFilter"];n=r[e+"_parentFilterName"]}else{t=r[e+"_filterRow"]()[0];n=e}s=ko.toJS(t)}if(r[e+"_newOne"]==null&&typeof (r[e+"_newOne"]!="undefined")&&r.isValid(e+"_newOne")){}else{i=e}var o={action:"DMDynamicRequest",formaction:"AddNew",formParameters:{formName:e,formId:r.formName},returnFormParameters:{formId:r.formName},currUrl:window.location.href,filter:{name:n,data:s},model:{name:i,data:ko.toJS(r[e+"_newOne"])}};var u=function(t){var n=t.indexOf('{"error":');var i=t.substring(n,t.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){r[e+"_errorMessage"](s["error"]);$("body").css("cursor","default")}else{if(typeof s["result"]!="undefined"&&s["result"]!=null&&typeof s["updatedData"]!="undefined"&&s["updatedData"]!=null){r[e+"_successMessage"](s["result"]);r.ReadData(s["updatedData"]);$("body").css("cursor","default")}}};r[e+"_successMessage"]();r[e+"_errorMessage"]();$("body").css("cursor","progress");applyToServer(u,u,o)};r.CreateDefaultForm=function(e,t,n){var i=confirm("Are you sure you want to recode the design?");if(i){if(DM_IsSet(t)&&DM_IsSet(e)&&DM_IsSet(t[e])&&DM_IsSet(n)&&DM_IsSet(t[n])){var s={action:"DMDynamicRequest",formaction:"CreateDefaultForm",formParameters:{formId:r.formName},entityId:t[e]};var o=function(e){var r=e.indexOf('{"error":');var i=e.substring(r,e.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){alert(s["error"])}else{t[n](s["result"])}};applyToServer(o,o,s)}}};r.remove=function(e,t){if(typeof r[e]!="undefined"){r[e].destroy(t);r[e+"pagetrigger"].notifySubscribers()}};r.showMe=function(e){e["ShowExtend"](true)};r.hideMe=function(e){e["ShowExtend"](false)};r.saveItemData=function(e,t){if(r[e]!=null&&typeof (r[e]!="undefined")){if(r[e+"_isFilteredDefault"]==true){filterow=r[e+"_filterRow"]()[0];var n={action:"DMDynamicRequest",formaction:"SaveData",formParameters:{formName:e,formId:r.formName},returnFormParameters:{formId:r.formName},filter:{name:e,data:ko.toJS(filterow)},model:{name:e,data:ko.toJS(t)}}}else{var n={action:"DMDynamicRequest",formaction:"SaveData",formParameters:{formName:e,formId:r.formName},returnFormParameters:{formId:r.formName},model:{name:e,data:ko.toJS(t)}}}var i=function(t){var n=t.indexOf('{"error":');var i=t.substring(n,t.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){r[e+"_errorMessage"](s["error"]);$("body").css("cursor","default")}else{if(typeof s["result"]!="undefined"&&s["result"]!=null&&typeof s["updatedData"]!="undefined"&&s["updatedData"]!=null){r[e+"_successMessage"](s["result"]);r.ReadData(s["updatedData"]);$("body").css("cursor","default")}}};r[e+"_successMessage"]();r[e+"_errorMessage"]();$("body").css("cursor","progress");applyToServer(i,i,n)}};r.deleteItemData=function(e,t){var n=confirm("Are you sure you want to delete this row?");if(n){var i=null;var s=null;var o=null;var u=null;if(DM_IsSet(r[e+"_DefaultQuery"])&&r[e+"_DefaultQuery"]==true||DM_IsSet(r[e+"_sendParentFilter"])&&r[e+"_sendParentFilter"]==true){if(DM_IsSet(r[e+"_sendParentFilter"])&&r[e+"_sendParentFilter"]==true){i=r[e+"_parentFilter"];s=r[e+"_parentFilterName"]}else{i=r[e+"_filterRow"]()[0];s=e}u=ko.toJS(i)}if(r[e+"_newOne"]==null&&typeof (r[e+"_newOne"]!="undefined")&&r.isValid(e+"_newOne")){}else{o=e}var a={action:"DMDynamicRequest",formaction:"DeleteData",formParameters:{formName:e,formId:r.formName},returnFormParameters:{formId:r.formName},currUrl:window.location.href,filter:{name:s,data:u},model:{name:o,data:ko.toJS(t)}};var f=function(t){var n=t.indexOf('{"error":');var i=t.substring(n,t.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){r[e+"_errorMessage"](s["error"]);$("body").css("cursor","default")}else{if(typeof s["result"]!="undefined"&&s["result"]!=null&&typeof s["updatedData"]!="undefined"&&s["updatedData"]!=null){r[e+"_successMessage"](s["result"]);r.ReadData(s["updatedData"]);$("body").css("cursor","default")}}};r[e+"_successMessage"]();r[e+"_errorMessage"]();$("body").css("cursor","progress");applyToServer(f,f,a)}};r.addNewRow=function(e){if(r[e]!=null&&typeof (r[e]!="undefined")&&r[e+"_new"]!=null&&typeof r[e+"_new"]!="undefined"&&r.isValid(e+"_new")){var t="_new";var n=r[e+"_new"]()[0];var i=new DM_ItemFromItem(n);i["newRow"](true);DM_AddValidators(i,r[e+t+"Validators"]);DM_AddFormulas(i,r[e+t+"Formulas"]);r[e].push(i);r[e+"_new"]([]);var s=new DM_Copy(r[e+"_newReserve"],false);DM_AddValidators(s,r[e+t+"Validators"]);DM_AddFormulas(s,r[e+t+"Formulas"]);r.AddSpecialMemberModel(e,s);r[e+"_new"].push(s);r[e+"pagetrigger"].notifySubscribers()}};r.reset=function(e,t){if(r[e]!=null&&typeof (r[e]!="undefined")&&r[e+t]!=null&&typeof r[e+t]!="undefined"){var n=new DM_Copy(r[e+t+"Reserve"],false);if((t=="_new"||t=="_newOne")&&(r[e+"_isFiltered"]||r[e+"_isFilteredDefault"])){filterRow=r[e+"_filterRow"]()[0];DM_CopyFromFilter(n,filterRow)}DM_AddValidators(n,r[e+t+"Validators"]);DM_AddFormulas(n,r[e+t+"Formulas"]);newArray=ko.observableArray();r[e+t]([]);r.AddSpecialMemberModel(e,n);r[e+t].push(n);r.showMe(r[e+t]()[0])}};r.GetData=function(){var e={action:"DMDynamicRequest",formaction:"GetDataById",formParameters:{formId:r.formName}};var t=function(e){if(e.search("error")>-1){alert(e)}else{var t=JSON.parse(e);r.ReadData(t)}};applyToServer(t,t,e)};r.sortSpecial=function(e,t){if(r[e]!=null&&typeof (r[e]!="undefined")){if(r[e+"_"+t+"sorted"]!="Asc"){r[e].sort(function(e,n){return e[t]()>n[t]()?1:-1});r[e+"_"+t+"sorted"]="Asc";r[e+"_lastfilter"]=t}else{r[e].sort(function(e,n){return e[t]()>n[t]()?-1:1});r[e+"_"+t+"sorted"]="Desc";r[e+"_lastfilter"]=t}r[e+"pagetrigger"].notifySubscribers()}};r.saveData=function(e){if(typeof r[e]!="undefined"&&r[e]!=null){var t=null;var n=null;var i=null;var s=null;if(DM_IsSet(r[modelname+"_DefaultQuery"])&&r[modelname+"_DefaultQuery"]==true||DM_IsSet(r[modelname+"_sendParentFilter"])&&r[modelname+"_sendParentFilter"]==true){if(DM_IsSet(r[modelname+"_sendParentFilter"])&&r[modelname+"_sendParentFilter"]==true){t=r[modelname+"_parentFilter"];n=r[modelname+"_parentFilterName"]}else{t=r[modelname+"_filterRow"]()[0];n=modelname}s=ko.toJS(t)}if(r[modelname+"_newOne"]==null&&typeof (r[modelname+"_newOne"]!="undefined")&&r.isValid(modelname+"_newOne")){}else{i=modelname}var o={action:"DMDynamicRequest",formaction:"SaveChanges",formParameters:{formName:modelname,formId:r.formName},returnFormParameters:{formId:r.formName},currUrl:window.location.href,filter:{name:n,data:s},model:{name:i,data:ko.toJS(data)}};if(r.isValid(e)){var u=function(t){var n=t.indexOf('{"error":');var i=t.substring(n,t.length);var s=JSON.parse(i);if(typeof s["error"]!="undefined"&&s["error"]!=null){r[e+"_errorMessage"](s["error"]);$("body").css("cursor","default")}else{if(typeof s["result"]!="undefined"&&s["result"]!=null&&typeof s["updatedData"]!="undefined"&&s["updatedData"]!=null){r[e+"_successMessage"](s["result"]);r.ReadData(s["updatedData"]);$("body").css("cursor","default")}}};r[e+"_successMessage"]();r[e+"_errorMessage"]();$("body").css("cursor","progress");applyToServer(u,u,o)}}else alert("no such model name!"+e)};r.Preview=function(e,t){}}function DefineModels(){$("[id*='form_id_'] ").each(function(){formName=this.id;formNameArr=formName.split("_");formId=formNameArr[2];var e={action:"DMDynamicRequest",formaction:"GetDataById",formParameters:{formId:formId}};var t=function(e){if(e.search("error")>-1){alert(e)}else{var t=document.getElementById(id);ko.applyBindings(new DM_Model(e,formName),this)}};applyToServer(t,t,e)})}function applyToServer(e,t,n){var r=DM_getUrl();$.ajax({url:r,type:"POST",data:n,success:e,fail:t})}function DM_getUrl(){if(document.URL.indexOf("wp-admin")!=-1){return"admin-ajax.php"}else{return"/wp-admin/admin-ajax.php"}}function DM_ShowHideOnMouse(e,t){if(e!=null&&typeof e!="undefined"){var n=$(e).attr("id")+"_help";if(n!=null&&typeof n!="undefined"){if(t){document.getElementById(n).style.visibility="visible";document.getElementById(n).style.height="inherit";document.getElementById(n).style.position="absolute"}else{document.getElementById(n).style.visibility="hidden";document.getElementById(n).style.height="0";document.getElementById(n).style.position="absolute"}}}}